<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapitre 1 | Compte Rendu Opératoire</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="icon.ico">
</head>
    <body class="grosse">
        <main id="grosse-boite">
            <h3 class='retour'><a href="sommaire.html?skip=true">< Retour au sommaire</a></h3>
            <h1 id="usurpation-de-lidentit%C3%A9-du-compte-administrateur-de-ce-syst%C3%A8me">Usurpation de l'identité du compte administrateur de ce système</h1>
            <hr>
            <p>Pour usurper l'identité de l'administrateur, nous avons besoin de trouver son compte ainsi que son mot de passe. <br>
            Pour ce faire, nous avons besoin de 2 fichiers.</p>
            <p>Le premier fichier est <code>/etc/passwd</code> dans lequel sont stockés tous les comptes utilisateurs avec quelques informations supplémentaire.</p>
            <pre class="hljs"><code>cat /etc/passwd</code></pre>
            <p><img src="screens/II_2.png" alt="II_2"></p>
            <p>Le seul compte susceptible de nous intéreser est <code>marlinspike</code>, il a un nom atypique et son répertoire utilisateur se situe dans <code>/home</code>.</p>
            <p>Le second fichier qui nous intéresse est <code>/etc/shadow</code> où sont stockés les mots de passe.</p>
            <pre class="hljs"><code>cat /etc/shadow</code></pre>
            <p><img src="screens/II_1.png" alt="II_1"></p>
            <p>Le seul compte qui sort du lot est encore <code>marlinspike</code>, c'est le seul compte où un mot de passe est indiqué.<br>
            Malheuresement (ou heureusement pour les utilisateurs) le mot de passe est chiffré et il nous est impossible de l'utiliser tel quel.</p>
            <p>Cependant, il existe des outils pour retrouver de façon un peu brutale le mot de passe en clair. Dans notre cas, nous allons utiliser <code>JohnTheRipper</code>.</p>
            <p>Nous allons d'abord regrouper les informations trouvées sur notre utilisateur dans un seul et même fichier. Pour cela nous copions les lignes indiquant <code>marlinspike</code> pour les écrire dans deux fichiers (passwdVM et shadowVM).</p>
            <pre class="hljs"><code>echo &quot;marlinspike:x:1000:1000:marlinspike,,,:/home/marlinspike:/bin/bash&quot; &gt; passwdVM
echo &quot;marlinspike:$6$wQb5nV3T$xB2WO/jOkbn4t1RUILrckw69LR/0EMtUbFFCYpM3MUHVmtyYW9.ov/aszTpWhLaC2x6Fvy5tpUUxQbUhCKbl4/:17484:0:99999:7:::&quot;<br> &gt; shadowVM
unshadow passwdVM shadowVM &gt; annuaireVM</code></pre>
            <p>La commande <code>unshadow</code> va récuperer le contenu de nos 2 fichiers pour les combiner en un seul.</p>
            <p>Avant de tenter de bruteforce le hash, nous lançons john de façon classique :</p>
            <pre class="hljs"><code>john annuaireVM</code></pre>
            <p><img src="screens/II_3.png" alt="II_3"></p>
            <p>À ce moment là nous nous sommes sentis un peu bête de ne pas l'avoir tenté avant mais le mot de passe du compte <code>marlinspike</code> est  <code>marlinspike</code>.</p>
            <p>Il suffit maintenant de nous connecter en SSH pour pouvoir accéder à la machine en usurpant l'identité de l'utilisateur :</p>
            <pre class="hljs"><code>ssh marlinspike@192.168.19.128</code></pre>
            <p><img src="screens/II_4.png" alt="II_4"></p>
            <p>Nous voici connecté à la machine sous l'identité de &quot;marlinspike&quot;. Cependant nous ne sommes pas encore certain que cela soit un administrateur.<br>
            Nous allons donc voir si il est dans la liste des <code>sudoers</code>. La liste des compte ayant les droits pour administrer la machine.</p>
            <p>Il suffit de lancer une commande normalement impossible pour un utilisateur lambda avec le préfixe <code>sudo</code> :</p>
            <pre class="hljs"><code>sudo touch /test</code></pre>
            <p><img src="screens/II_8.png" alt="II_8"></p>
            <p>L'utilisateur <code>marlinspike</code> possède bien les droits d'administrateur sur la machine !</p>
            <menu>
                <p><a href="chap1.html">< Chapitre 1</a></p>
                <p><a href="chap3.html">Chapitre 3 ></a></p>
            </menu>
        </main>
    </body>
</html>